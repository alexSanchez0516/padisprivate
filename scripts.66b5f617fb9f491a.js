"use strict";Math.log2=Math.log2||function(o){return Math.log(o)/Math.LN2},Math.log10=Math.log10||function(o){return Math.log(o)/Math.LN10},function(){var o={avg:function(r){for(var i=0,e=0;e<r.length;++e)i+=r[e];return i/r.length},min:function(r){if(0===r.length)return 0;for(var i=r[0],e=1;e<r.length;++e){var t=r[e];Array.isArray(t)&&(t=o.avg(t)),t<i&&(i=t)}return Math.max(0,i)},max:function(r){for(var i=0,e=0;e<r.length;++e){var t=r[e];Array.isArray(t)&&(t=o.avg(t)),t>i&&(i=t)}return Math.max(0,i)},upperMax:function(r){for(var i=0,e=0;e<r.length;++e){var t=r[e];Array.isArray(t)&&(t=o.max(t)),t>i&&(i=t)}return Math.max(0,i)},lowerMin:function(r){if(0===r.length)return 0;var i=r[0]||1/0;Array.isArray(i)&&(i=o.lowerMin(i));for(var e=1;e<r.length;++e){var t=r[e];null!=t&&(Array.isArray(t)&&(t=o.lowerMin(t)),t<i&&(i=t))}return(isNaN(i)||!isFinite(i))&&(i=0),Math.max(0,i)},niceNumbers:function(r,i){var e=Math.floor(Math.log10(r)),t=r/Math.pow(10,e);return(i?t<1.5?1:t<3?2:t<7?5:10:t<=1?1:t<=2?2:t<=5?5:10)*Math.pow(10,e)},getLinearTicks:function(r,i,e){var t=o.niceNumbers(i-r,!1),a=o.niceNumbers(t/(e-1),!0);return[Math.floor(r/a)*a,Math.ceil(i/a)*a,a]},getFont:function(r){return r.style=r.style||"normal",r.variant=r.variant||"normal",r.weight=r.weight||"lighter",r.size=r.size||"12",r.family=r.family||"Arial",[r.style,r.variant,r.weight,r.size+"px",r.family].join(" ")},getAxisRatio:function(r,i,e){return(e-r)/(i-r)}},Qt=function(){function r(i,e){for(var t in this.mouseListeners=[],this.currentHint=null,this.fillRegions=[],this.options={font:"Helvetica",fontWeight:"normal",fontSizeTitle:24,fontSizeAxes:20,fontSizeTicks:18,fontSizeLabels:18,fontDataTags:18,fontSizeLegend:18,fontSizeHint:18,paddingPercentBars:.1,paddingPercentTicks:.15,paddingPixelsVertical:10,paddingPixelsHorizontal:10,paddingPixelsTicks:10,maxWidthBars:0,fillColorBackground:"rgb(255, 255, 255)",strokeColorBars:"rgb(0, 0, 0)",fillColorBars:"rgba(180, 180, 180, 0.25)",scaleStyle:"linear",barStyle:"none",stackedBarPadding:3,defaultMaxTick:0,pixelsLegendSquare:10,radiusDot:5,fillColorLegend:"rgb(230, 230, 230)",tickFormatter:null,tickFormatterMeasure:null,fillRegion:"normal"},e=e||{},this.options)e.hasOwnProperty(t)&&(this.options[t]=e[t]);this.ctx=i,this.content={},this.labelPositions={}}return r.prototype.update=function(i){if("object"!=typeof i)throw new Error("Collections must be objects.");if(!i.hasOwnProperty("labels")||!i.hasOwnProperty("data"))throw new Error("Collection must specify labels and data.");if(!Array.isArray(i.labels)||!Array.isArray(i.data))throw new Error("Labels and data must be arrays.");if(i.labels.length!==i.data.length)throw new Error("Labels and data length must match.");i._data_standard_deviation=[],i._data_standard_error=[];for(var e=0;e<i.data.length;++e){var t=Array.isArray(i.data[e]);if("log2"===this.options.scaleStyle)if(t)for(var a=0;a<i.data[e].length;++a)i.data[e][a]=Math.log2(i.data[e][a]);else i.data[e]=Math.log2(i.data[e]);if(t){for(var S=o.avg(i.data[e]),T=0,m=0;m<i.data[e].length;++m)T+=Math.pow(S-i.data[e][m],2);T=Math.sqrt(T/(i.data[e].length-1)),i._data_standard_deviation.push(T),i._data_standard_error.push(T/Math.sqrt(i.data[e].length))}else i._data_standard_deviation.push(0),i._data_standard_error.push(0)}this.content=i,this.redraw()},r.prototype.redraw=function(){setTimeout(function(){this._draw()}.bind(this),0)},r.prototype.mousemove=function(i,e){for(var t=null,a=0;a<this.mouseListeners.length&&!(t=this.mouseListeners[a](i,e));++a);if(t&&"object"==typeof t&&t.hasOwnProperty("index")&&t.hasOwnProperty("drawIndex")){var S=this.currentHint;(null==S||S.index!=t.index||S.drawIndex!=t.drawIndex)&&(this.currentHint=t,this.redraw())}else null!==this.currentHint&&(this.currentHint=null,this.redraw())},r.prototype._draw=function(){var i={};this.mouseListeners=[],this.fillRegions=[];var e=this.options,t=this.ctx,a=this.content,S=t.canvas.width,T=t.canvas.height;t.clearRect(0,0,S,T),t.translate(-.5,-.5);var l,m=S,n=T;null!=e.fillColorBackground&&(t.save(),t.fillStyle=e.fillColorBackground,t.fillRect(0,0,S,T),t.restore());var s=e.paddingPixelsHorizontal;n-=e.paddingPixelsHorizontal,t.fillStyle="rgb(0, 0, 0)",null!=a.title&&(t.save(),t.font=o.getFont({weight:e.fontWeight,size:e.fontSizeTitle,family:e.font}),t.textAlign="center",t.fillText(a.title,S/2,s+e.fontSizeTitle),t.restore(),n-=1.25*e.fontSizeTitle,s+=1.25*e.fontSizeTitle);var c=e.paddingPixelsVertical;m-=e.paddingPixelsVertical;var f,v,Zt=null;if(null!=a.yAxis&&(Zt=c+.5*e.fontSizeAxes,m-=1.25*e.fontSizeAxes,c+=1.25*e.fontSizeAxes),t.save(),t.font=o.getFont({weight:e.fontWeight,size:e.fontSizeTicks,family:e.font}),"stacked"===e.barStyle){f=0,v=1/0;for(var U=0;U<a.data.length;++U){var Lt;if(Array.isArray(Lt=a.data[U])){for(var _t=0,Rt=0;Rt<Lt.length;++Rt)_t+=Lt[Rt];f=Math.max(f,_t),v=Math.min(v,_t)}else f=Math.max(f,a.data[U]),v=Math.min(v,a.data[U])}}else f=o.upperMax(a.data),v=o.lowerMin(a.data);if(0===e.scaleStyle.indexOf("adaptive")){if(-1!==e.scaleStyle.indexOf(":")){var $t=parseFloat(e.scaleStyle.split(/[:]/)[1]);v*=$t,f*=1+(1-$t)/2}}else v=0;if(e.defaultMaxTick>f&&(f=e.defaultMaxTick),null!=a.bars&&Array.isArray(a.bars))for(l=0;l<a.bars.length;++l){var Ct=a.bars[l].value;isNaN(Ct)||(f=Math.max(f,Ct),v=Math.min(v,Ct))}var N="log2"==e.scaleStyle?Math.ceil(Math.pow(2,f)):Math.ceil(f)+".00";if(null!=e.tickFormatterMeasure&&(N=e.tickFormatterMeasure),N=t.measureText(N).width,m-=N=Math.ceil(N)+e.paddingPixelsTicks,c+=N,t.restore(),m-=e.paddingPixelsVertical,null!=a.legend&&Array.isArray(a.legend)){t.save(),t.font=o.getFont({weight:e.fontWeight,size:e.fontSizeLegend,family:e.font});for(var O=0,x=0;x<a.legend.length;++x)O=Math.max(O,t.measureText(a.legend[x].label).width);O=Math.ceil(O),O+=e.pixelsLegendSquare+8;var V,D,Bt=Math.floor((m-2*e.paddingPixelsHorizontal)/O),dt=Math.ceil(a.legend.length/Bt)*e.fontSizeLegend*1.5;for(n-=dt,X+=dt,t.strokeStyle="rgb(0, 0, 0)",t.fillStyle=e.fillColorLegend,t.beginPath(),t.moveTo(V=c,D=s+n),t.lineTo(V+m,D),t.lineTo(V+m,D+dt),t.lineTo(V,D+dt),t.lineTo(V,D),t.stroke(),t.fill(),x=0;x<a.legend.length;++x){var re=Math.floor(x/Bt),ne=x%Bt;t.fillStyle=a.legend[x].color;var G=V+ne*O+3,J=D+re*e.fontSizeLegend*1.5+.5*e.fontSizeLegend;t.beginPath(),t.moveTo(G,J),t.lineTo(G+e.pixelsLegendSquare,J),t.lineTo(G+e.pixelsLegendSquare,J+e.pixelsLegendSquare),t.lineTo(G,J+e.pixelsLegendSquare),t.lineTo(G,J),t.fill(),t.stroke(),t.textAlign="left",t.fillStyle="rgb(0, 0, 0)",t.fillText(a.legend[x].label,G+3+e.pixelsLegendSquare,J+.5*e.fontSizeLegend)}t.restore()}var X=e.paddingPixelsHorizontal;n-=e.paddingPixelsHorizontal,null!=a.xAxis&&(t.save(),t.font=o.getFont({weight:e.fontWeight,size:e.fontSizeAxes,family:e.font}),t.fillStyle="rgb(0, 0, 0)",t.textAlign="center",t.fillText(a.xAxis,S-m+m/2,s+n-X),n-=1.5*e.fontSizeAxes,X+=1.5*e.fontSizeAxes,t.restore());var g=m/a.data.length;if(null!=a.topLabels){for(t.save(),t.textAlign="center",t.font=o.getFont({weight:e.fontWeight,size:e.fontSizeLabels,family:e.font}),n-=1.5*e.fontSizeLabels,s+=1.5*e.fontSizeLabels,l=0;l<a.topLabels.length;++l)t.fillText(a.topLabels[l],c+l*g+g/2,s-e.fontSizeLabels/2);t.restore()}t.save();var K=0;if(null!=a.dataTags){t.font=o.getFont({weight:e.fontWeight,size:e.fontDataTags,family:e.font});var Y=a.dataTags;for(l=0;l<Y.length;++l)if(Array.isArray(Y[l]))for(var b=0;b<Y[l].length;++b)K=Math.max(K,Math.ceil(t.measureText(Y[l][b]).width+5));else K=Math.max(K,Math.ceil(t.measureText(Y[l]).width+5))}t.font=o.getFont({weight:e.fontWeight,size:e.fontSizeLabels,family:e.font});var A=Math.floor(g*e.paddingPercentBars/2),Ft=g-2*A;Ft<K?(A-=Math.ceil((K-Ft)/2),A=Math.max(0,A)):e.maxWidthBars>0&&Ft>e.maxWidthBars&&(A=Math.floor((g-e.maxWidthBars)/2));var C=0,St=1;for(l=0;l<a.labels.length;++l){var I=a.labels[l];if(Array.isArray(I))for(St=Math.max(St,I.length),b=0;b<I.length;++b)C=Math.max(C,t.measureText(I[b]).width);else C=Math.max(C,t.measureText(I).width)}var tt=!1;C>g-A?(t.textAlign="right",t.rotate(1.5*Math.PI),tt=!0):t.textAlign="center";var Ht=-e.fontSizeLabels;for(l=0;l<a.labels.length;++l){var et=a.labels[l],Tt=c+l*g+g/2,q=s+n-e.fontSizeLabels/2;if(tt){if((q=[Tt,Tt=-(q=s+n-C+5)][0])<Ht+e.fontSizeLabels)continue;Ht=q}var Q=e.fontSizeLabels*(St-1);if(Array.isArray(et))for(tt&&(Q=e.fontSizeLabels*(et.length-1.5),Q/=2),b=0;b<et.length;++b)t.fillText(et[b],Tt,q-Q),Q-=e.fontSizeLabels;else tt&&(Q=.25*-e.fontSizeLabels),t.fillText(et,Tt,q-Q)}if(tt)n-=C+5,X+=C+5;else{var Nt=e.fontSizeLabels*St;n-=Nt+=.5*e.fontSizeLabels,X+=Nt}t.restore();var bt=c,Ot=c+m,B=s,at=s+n;for(l=0;l<a.labels.length;++l)i[l]={xStart:c+l*g,xEnd:c+(1+l)*g,yStart:B,yEnd:at};t.save(),t.strokeStyle="rgb(0, 0, 0)",t.beginPath(),null!=a.topLabels?(t.moveTo(Ot,B),t.lineTo(bt,B)):t.moveTo(bt,B),t.lineTo(bt,at),t.lineTo(Ot,at),null!=a.topLabels&&t.lineTo(c+m,s),t.stroke(),t.restore(),null!=a.topLabel&&(t.save(),t.textAlign="right",t.font=o.getFont({weight:e.fontWeight,size:e.fontSizeLabels,family:e.font}),t.fillText(a.topLabel,c-3,s-e.fontSizeLabels/2),t.restore()),null!=a.yAxis&&(t.save(),t.rotate(1.5*Math.PI),t.font=o.getFont({weight:e.fontWeight,size:e.fontSizeAxes,family:e.font}),t.fillStyle="rgb(0, 0, 0)",t.textAlign="center",t.fillText(a.yAxis,-(s+n/2),Zt),t.restore()),t.save(),t.fillStyle="rgb(0, 0, 0)",t.strokeStyle="rgba(0, 0, 0, 0.20)",t.font=o.getFont({weight:e.fontWeight,size:e.fontSizeTicks,family:e.font}),t.textAlign="right";var Z=o.getLinearTicks(0,f,Math.max(2,n/(e.fontSizeTicks*(1+e.paddingPercentTicks)))),Et=f/e.fontSizeTicks;f=Z[1],f+=f>1?Math.ceil(Et):Et;for(var w=[];Z[0]<=Z[1];)w.push(Z[0]),Z[0]+=Z[2];for(l=0;l<w.length;++l){var lt=Math.round(n*o.getAxisRatio(v,f,w[l]));lt<0||(w[l]="log2"==e.scaleStyle&&0!==w[l]?Math.round(Math.pow(2,w[l])):Math.floor(100*w[l])/100,t.fillText(null!=e.tickFormatter&&"function"==typeof e.tickFormatter?e.tickFormatter(w[l]).toString():w[l].toString(),c-e.paddingPixelsTicks,s+n-lt),0!=l&&(t.beginPath(),t.moveTo(c,s+n-lt),t.lineTo(c+m,s+n-lt),t.stroke()))}if(t.restore(),null!=a.bars&&Array.isArray(a.bars)){for(t.save(),l=0;l<a.bars.length;++l){var zt=a.bars[l];if(!(zt.value>f)){var Ut=s+n-Math.round(n*o.getAxisRatio(v,f,zt.value));t.strokeStyle=zt.style,t.fillStyle=zt.style,t.beginPath(),t.moveTo(bt,Ut),t.lineTo(Ot,Ut),t.stroke(),t.fill()}}t.restore()}t.save();var h=null;for(l=0;l<a.data.length;++l){var $=null,z=null;null!=a.fillColor?Array.isArray(a.fillColor)?$=t.fillStyle=a.fillColor[l]:t.fillStyle=a.fillColor:t.fillStyle=e.fillColorBars,null!=a.strokeColor?Array.isArray(a.strokeColor)?z=t.strokeStyle=a.strokeColor[l]:t.strokeStyle=a.strokeColor:t.strokeStyle=e.strokeColorBars;var L=a.data[l],qt=Array.isArray(L),d=c+g*l;if(qt&&"stacked"===e.barStyle){for(var Xt=0,it=0,y=0;y<L.length;++y){null!=$&&Array.isArray($)&&(t.fillStyle=$[y]||e.fillColorBars),null!=z&&Array.isArray(z)&&(t.strokeStyle=z[y]||e.strokeColorBars);var pt=Math.floor(n*o.getAxisRatio(v,f,Xt+=L[y])),kt=s+n-pt;if(Math.abs(pt-it)<e.stackedBarPadding+2)it=pt;else{var Wt,rt,It,te,Pt,Yt=y>0?e.stackedBarPadding:0;if(t.beginPath(),t.moveTo(Wt=d+A,rt=s+n-it-Yt),t.lineTo(d+A,kt),t.lineTo(It=d+(g-1)-A,te=kt),t.lineTo(d+(g-1)-A,s+n-it-Yt),y>0&&t.lineTo(Wt,rt),t.stroke(),t.fill(),null!=a.hints&&null!=a.hints[l]&&null!=(nt=a.hints[l][y])&&this.mouseListeners.push(function(fe,Jt,Kt,ft,ht,gt,ut,vt,yt){var ct=Math.min(ft,gt),mt=Math.max(ft,gt),At=Math.min(ht,ut),Mt=Math.max(ht,ut);return vt<ct||vt>mt||yt<At||yt>Mt?null:{index:fe,drawIndex:Jt,rect:{left:ct,right:mt,top:At,bottom:Mt},text:Kt.split("\n")}}.bind(this,l,y,nt,Wt,rt,It,te)),rt-kt>1.25*e.fontDataTags&&null!=a.dataTags&&null!=(Pt=a.dataTags[l])&&null!=(Pt=Pt[y])){var oe=t.fillStyle;t.fillStyle="rgb(0, 0, 0)",t.font=o.getFont({weight:e.fontWeight,size:e.fontDataTags,family:e.font}),t.textAlign="center",t.fillText(Pt,d+g/2,rt-.25*e.fontDataTags),t.fillStyle=oe}it=pt}}null!=a.barTooltips&&(t.fillStyle="rgb(0, 0, 0)",t.font=o.getFont({weight:e.fontWeight,size:e.fontSizeLabels,family:e.font}),t.textAlign="center",t.fillText(a.barTooltips[l]||"",d+g/2,kt-3))}else if("line"===e.barStyle){if(qt){var M=d+g/2;if("background"===e.fillRegion&&(u=h,Array.isArray(u)&&(u=u[0]),null!=u)){var jt=t.fillStyle;t.fillStyle=u.color,t.fillRect(u.x,B,M-u.x,at-B),t.fillStyle=jt}var ee=[];for(y=0;y<L.length;++y){var F=s+n-Math.round(n*o.getAxisRatio(v,f,L[y]));null!=h&&(Array.isArray(h)?(p=(h[y]||{}).x,k=(h[y]||{}).y):(p=h.x,k=h.y),p&&k&&(t.strokeStyle=Array.isArray(z)?z[y]||e.strokeColorBars:z||"rgb(0, 0, 0)",t.beginPath(),t.moveTo(p,k),t.lineTo(M,F),t.stroke())),Array.isArray($)&&(t.fillStyle=$[y]||e.fillColorBars),Array.isArray(z)&&(t.strokeStyle=z[y]||e.strokeColorBars),t.beginPath(),t.arc(M,F,e.radiusDot,0,2*Math.PI),t.stroke(),t.fill(),ee[y]={x:M,y:F,color:t.fillStyle}}h=ee,null!=u&&u.color!=h[0].color&&this.fillRegions.push({x:h[0].x,y:h[0].y,prev:u.color,next:h[0].color}),null!=a.balls&&Array.isArray(a.balls)&&l<a.balls.length&&null!=(P=a.balls[l])&&(t.beginPath(),t.fillStyle=P.fill,t.strokeStyle=P.stroke,t.arc(M,s+n-n*o.getAxisRatio(v,f,v+P.value),P.radius,0,2*Math.PI),t.stroke(),t.fill())}else{var u,P;if(M=d+g/2,F=s+n-Math.round(n*o.getAxisRatio(v,f,L)),"background"===e.fillRegion&&null!=h&&(u=h,Array.isArray(u)&&(u=u[0]),jt=t.fillStyle,t.fillStyle=u.color,t.fillRect(u.x,B,M-u.x,at-B),t.fillStyle=jt),t.beginPath(),t.arc(M,F,e.radiusDot,0,2*Math.PI),t.stroke(),t.fill(),null!=h)if(Array.isArray(h))for(var Gt in h)!h.hasOwnProperty(Gt)||(k=h[Gt].y,(p=h[Gt].x)&&k&&(t.strokeStyle=z||"rgb(0, 0, 0)",t.beginPath(),t.moveTo(p,k),t.lineTo(M,F),t.stroke()));else{var p,k=h.y;(p=h.x)&&k&&(t.strokeStyle=z||"rgb(0, 0, 0)",t.beginPath(),t.moveTo(p,k),t.lineTo(M,F),t.stroke())}h={x:M,y:F,color:t.fillStyle},null!=u&&u.color!=h.color&&this.fillRegions.push({x:h.x,y:h.y,prev:u.color,next:h.color}),null!=a.balls&&Array.isArray(a.balls)&&l<a.balls.length&&null!=(P=a.balls[l])&&(t.beginPath(),t.fillStyle=P.fill,t.strokeStyle=P.stroke,t.arc(M,s+n-n*o.getAxisRatio(v,f,v+P.value),P.radius,0,2*Math.PI),t.stroke(),t.fill())}var nt;null!=a.hints&&null!=(nt=a.hints[l])&&this.mouseListeners.push(function(Jt,Kt,ft,ht,gt,ut,vt,yt){var ct=Math.min(ft,gt),mt=Math.max(ft,gt),At=Math.min(ht,ut),Mt=Math.max(ht,ut);return vt<ct||vt>mt||yt<At||yt>Mt?null:{index:Jt,drawIndex:y,rect:{left:ct,right:mt,top:At,bottom:Mt},text:Kt.split("\n")}}.bind(this,l,nt,M-1,s,M+1,s+n))}else{qt&&(L=o.avg(L));var ae,_=s+n-Math.round(n*o.getAxisRatio(v,f,L));if(t.beginPath(),t.moveTo(d+A,s+n),t.lineTo(d+A,_),t.lineTo(d+(g-1)-A,_),t.lineTo(d+(g-1)-A,s+n),t.stroke(),t.fill(),"error"===e.barStyle&&0!=(ae=a._data_standard_error[l])){var H=Math.round(n*o.getAxisRatio(v,f,ae));t.beginPath();var xt=Math.round((g-2*A)/8),E=c+g*l+g/2;t.moveTo(E-xt,_+H),t.lineTo(E+xt,_+H),t.moveTo(E,_+H),t.lineTo(E,_-H),t.moveTo(E-xt,_-H),t.lineTo(E+xt,_-H),t.stroke()}null!=a.barTooltips&&(t.fillStyle="rgb(0, 0, 0)",t.font=o.getFont({weight:e.fontWeight,size:e.fontSizeLabels,family:e.font}),t.textAlign="center",t.fillText(a.barTooltips[l]||"",d+g/2,_-3))}}if(t.restore(),null!=this.currentHint){t.save();var wt=this.currentHint.rect,ot=this.currentHint.text;t.fillStyle="rgb(0, 0, 0)",t.font=o.getFont({weight:e.fontWeight,size:e.fontSizeHint,family:e.font}),t.textAlign="left";var W=0;for(l=0;l<ot.length;++l)W=Math.max(W,Math.ceil(t.measureText(ot[l]).width));var ie=1.5*e.fontSizeHint,R=ot.length*ie,st=wt.right+10,j=(wt.top+wt.bottom)/2;for(st+(W+=10)>S&&(st=wt.left-W-10),j-R/2<0?j=Math.ceil(R/2)+1:j+R/2>T&&(j=T-R/2-1),t.clearRect(st,j-R/2,W,R),t.beginPath(),t.rect(st,j-R/2,W,R),t.stroke(),l=0;l<ot.length;++l)t.fillText(ot[l],st+5,j-R/2+e.fontSizeHint+l*ie);t.restore()}t.translate(.5,.5),this.labelPositions=i},r}();typeof module<"u"&&typeof module.exports<"u"?module.exports=Qt:window.BarChart=Qt}();